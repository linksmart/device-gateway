language: go

go:
- 1.12.x

env:
  global:
    - NAME=device-gateway
    - VERSION=${TRAVIS_BRANCH}
    - BUILDNUM=$TRAVIS_BUILD_NUMBER

# skip default install and script commands
install: true
script: true

before_deploy:
  - tar cf sample_conf.tar sample_conf

deploy:
  - provider: script
    script: curl -s https://raw.githubusercontent.com/linksmart/ci-scripts/master/go/go-build.sh | bash
    on:
      condition: $TRAVIS_BRANCH == "master" || -n $TRAVIS_TAG
  # releases
  - provider: releases
    api_key: $GITHUB_KEY
    file_glob: true
    file:
      - bin/*
      - sample_conf.tar
    skip_cleanup: true
    overwrite: true
    on:
      tags: true
  # snapshots
  - provider: releases
    api_key: $GITHUB_KEY
    file_glob: true
    file:
      - bin/*
      - sample_conf.tar
    skip_cleanup: true
    overwrite: true
    draft: true
    on:
      tags: master
